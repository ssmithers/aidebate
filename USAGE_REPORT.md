# Post-Debate Usage Report

## How to Get Your Usage Report

After completing a debate, call the usage endpoint to see exactly what models were used:

```javascript
// After debate completes
const sessionId = "your-session-id";
const response = await fetch(`http://localhost:5000/api/debate/usage/${sessionId}`);
const report = await response.json();
console.log(report);
```

---

## Report Format

```json
{
  "session_id": "abc-123",
  "topic": "Universal basic income is beneficial for society",
  "total_speeches": 16,

  "usage_breakdown": [
    {
      "model": "claude-opus-4-6",
      "model_type": "anthropic",
      "purpose": "debate_content",
      "speeches": ["1AC", "2AC", "1AR", "2AR"],
      "total_input_tokens": 6400,
      "total_output_tokens": 4200,
      "total_calls": 4,
      "estimated_cost": 0.411
    },
    {
      "model": "zai-org/glm-4.7-flash",
      "model_type": "lm_studio",
      "purpose": "debate_content",
      "speeches": ["1NC", "2NC", "1NR", "2NR", ...],
      "total_input_tokens": 0,
      "total_output_tokens": 0,
      "total_calls": 12,
      "estimated_cost": 0.0
    },
    {
      "model": "claude-haiku-4-5",
      "model_type": "anthropic",
      "purpose": "formatting",
      "speeches": ["1AC", "CX by 2N", "1NC", ...],
      "total_input_tokens": 12800,
      "total_output_tokens": 3200,
      "total_calls": 16,
      "estimated_cost": 0.007
    }
  ],

  "totals": {
    "anthropic_input_tokens": 19200,
    "anthropic_output_tokens": 7400,
    "local_model_calls": 12,
    "estimated_cost_if_api_key": 0.418
  },

  "notes": [
    "All Anthropic API calls use SUBSCRIPTION CREDITS FIRST",
    "API key is only charged when subscription exhausted",
    "Actual cost may be $0 if using subscription credits",
    "Estimated API key cost if no subscription: $0.4180",
    "Local LM Studio calls are always FREE"
  ]
}
```

---

## Understanding the Report

### usage_breakdown
- **One entry per model/purpose combination**
- Shows which speeches used which model
- Token counts for Anthropic models (local models don't report tokens)
- Estimated cost is IF you were using API key (not subscription)

### Model Types

**anthropic**:
- Claude Opus, Sonnet, or Haiku
- Uses subscription credits first automatically
- Falls back to API key when subscription exhausted

**lm_studio**:
- Local models (GLM-Flash, etc.)
- Always FREE
- No token tracking (runs on your hardware)

### Purposes

**debate_content**:
- Actual debate arguments generated by selected models
- User's choice (could be Opus or local model)

**formatting**:
- Always Haiku 4.5
- Cleans thinking blocks from all debate outputs
- ~$0.001 per speech (negligible cost)

---

## Cost Interpretation

### "estimated_cost_if_api_key"
- This is what you'd pay if using ONLY API key credits
- **NOT your actual cost** if you have subscription credits
- Subscription credits are used first automatically

### Actual Cost Scenarios

**If you have subscription credits remaining:**
- Actual cost: **$0.00** (uses subscription)
- Report shows: "estimated_cost_if_api_key: $0.42"
- Meaning: You saved $0.42 by using subscription

**If your subscription is exhausted:**
- Actual cost: **~$0.42** (charges API key)
- Report shows: "estimated_cost_if_api_key: $0.42"
- Meaning: This is what was charged to your API key

### Local Models
- GLM-Flash and other LM Studio models
- Always $0.00 (runs on your hardware)
- No API calls, no subscription usage, no costs

---

## Example Interpretations

### Scenario 1: Opus vs GLM-Flash
```
Debate: Opus (Aff) vs GLM-Flash (Neg) - 16 speeches

usage_breakdown:
  - Opus debate_content: 8 speeches, $0.32
  - Haiku formatting: 16 speeches, $0.016
  - GLM-Flash: 8 speeches, $0.00 (local)

Total estimated: $0.336
Actual cost: $0.00-0.336 (depends on subscription)
```

### Scenario 2: GLM-Flash vs GLM-Flash
```
Debate: GLM-Flash (Both sides) - 16 speeches

usage_breakdown:
  - Haiku formatting: 16 speeches, $0.016
  - GLM-Flash: 16 speeches, $0.00 (local)

Total estimated: $0.016
Actual cost: $0.00-0.016 (depends on subscription)
```

---

## How to Check Subscription Status

**In Anthropic Console:**
1. Go to anthropic.com/account
2. Check "Usage & Billing"
3. See subscription credit balance

**When subscription runs out:**
- API calls automatically switch to API key billing
- You'll see charges on your Anthropic account
- Report's "estimated_cost" becomes your actual cost

---

## Adding to UI (Optional)

You can display the report after debates:

```javascript
// In app.js after debate ends
async function showUsageReport() {
    const report = await API.getUsageReport(currentSession.session_id);

    let html = '<div class="usage-report">';
    html += '<h3>Model Usage Report</h3>';

    for (const usage of report.usage_breakdown) {
        html += `<div class="usage-item">`;
        html += `<strong>${usage.model}</strong> (${usage.purpose})<br>`;
        html += `Speeches: ${usage.total_calls}<br>`;

        if (usage.model_type === "anthropic") {
            html += `Tokens: ${usage.total_input_tokens} in / ${usage.total_output_tokens} out<br>`;
            html += `Est. cost: $${usage.estimated_cost.toFixed(4)}<br>`;
        } else {
            html += `Cost: FREE (local model)<br>`;
        }

        html += `</div>`;
    }

    html += `<div class="usage-total">`;
    html += `<strong>Total Est. Cost (if using API key):</strong> $${report.totals.estimated_cost_if_api_key.toFixed(4)}<br>`;
    html += `<em>Actual cost may be $0.00 if using subscription credits</em>`;
    html += `</div></div>`;

    DebateUI.appendMessage(html);
}
```

---

## Summary

✅ **After each debate, you'll know:**
- Which models were used for what
- How many tokens each model consumed
- Estimated API key cost (if no subscription)
- Whether calls were Anthropic (subscription/API) or local (free)

✅ **Key takeaway:**
- Report shows "worst case" cost (all API key)
- Actual cost is likely lower (subscription used first)
- Local models always show $0.00

---

**To get your report:**
```bash
curl http://localhost:5000/api/debate/usage/<session-id>
```

Or add a "Show Usage Report" button to the UI!
